"use strict";class JudgeLineEvent{constructor(start,end,start2,end2,startTime,endTime){this.startTime=startTime,this.endTime=endTime,this.start=start,this.end=end,this.start2=start2,this.end2=end2}}class Note{constructor(type,time,positionX,holdTime,speed){this.type=type,this.time=time,this.positionX=positionX,this.holdTime=holdTime,this.speed=speed,this.floorPosition=0}}class SpeedEvent{constructor(value,startTime,endTime){this.startTime=startTime,this.endTime=endTime,this.floorPosition=0,this.value=value}}class JudgeLine{constructor(){this.numOfNotes=0,this.numOfNotesAbove=0,this.numOfNotesBelow=0,this.bpm=120,this.speedEvents=[],this.notesAbove=[],this.notesBelow=[],this.judgeLineDisappearEvents=[],this.judgeLineMoveEvents=[],this.judgeLineRotateEvents=[]}updateSefp(){let y=0;this.speedEvents.sort((a,b)=>a.startTime-b.startTime);for(const i of this.speedEvents)i.startTime<0&&(i.startTime=0),i.floorPosition=y,y+=(i.endTime-i.startTime)*i.value/this.bpm*1.875;this.speedEvents[this.speedEvents.length-1].endTime=1e9;for(const j of this.notesAbove){let qwqwq=0,qwqwq2=0,qwqwq3=0;for(const k of this.speedEvents)if(!(j.time%1e9>k.endTime)){if(j.time%1e9<k.startTime)break;qwqwq=k.floorPosition,qwqwq2=k.value,qwqwq3=j.time%1e9-k.startTime}j.floorPosition=qwqwq+qwqwq2*qwqwq3/this.bpm*1.875}for(const j of this.notesBelow){let qwqwq=0,qwqwq2=0,qwqwq3=0;for(const k of this.speedEvents)if(!(j.time%1e9>k.endTime)){if(j.time%1e9<k.startTime)break;qwqwq=k.floorPosition,qwqwq2=k.value,qwqwq3=j.time%1e9-k.startTime}j.floorPosition=qwqwq+qwqwq2*qwqwq3/this.bpm*1.875}}updateDe(){this.judgeLineDisappearEvents.sort((a,b)=>a.startTime-b.startTime),this.judgeLineMoveEvents.sort((a,b)=>a.startTime-b.startTime),this.judgeLineRotateEvents.sort((a,b)=>a.startTime-b.startTime),this.judgeLineDisappearEvents=arrangeLineEvent(this.judgeLineDisappearEvents),this.judgeLineMoveEvents=arrangeLineEvent(this.judgeLineMoveEvents),this.judgeLineRotateEvents=arrangeLineEvent(this.judgeLineRotateEvents)}}class Chart{constructor(){this.formatVersion=3,this.offset=0,this.numOfNotes=0,this.judgeLineList=[]}}function reverseChart(chart,duration){const chartNew=new Chart;chartNew.offset=-chart.offset;for(const i of chart.judgeLineList){const judgeLine=new JudgeLine,tb=duration*i.bpm/1.875;judgeLine.bpm=i.bpm;for(const j of i.speedEvents)judgeLine.speedEvents.push(new SpeedEvent(j.value,tb-j.endTime,tb-j.startTime));for(const j of i.notesAbove)judgeLine.notesAbove.push(new Note(j.type,tb-j.time-j.holdTime,j.positionX,j.holdTime,j.speed)),judgeLine.numOfNotesAbove++;for(const j of i.notesBelow)judgeLine.notesBelow.push(new Note(j.type,tb-j.time-j.holdTime,j.positionX,j.holdTime,j.speed)),judgeLine.numOfNotesBelow++;judgeLine.numOfNotes+=judgeLine.numOfNotesAbove+judgeLine.numOfNotesBelow,chartNew.numOfNotes+=judgeLine.numOfNotes,judgeLine.updateSefp();for(const j of arrangeLineEvent(i.judgeLineDisappearEvents))judgeLine.judgeLineDisappearEvents.push(new JudgeLineEvent(j.end,j.start,j.end2,j.start2,tb-j.endTime,tb-j.startTime));for(const j of arrangeLineEvent(i.judgeLineMoveEvents))judgeLine.judgeLineMoveEvents.push(new JudgeLineEvent(j.end,j.start,j.end2,j.start2,tb-j.endTime,tb-j.startTime));for(const j of arrangeLineEvent(i.judgeLineRotateEvents))judgeLine.judgeLineRotateEvents.push(new JudgeLineEvent(j.end,j.start,j.end2,j.start2,tb-j.endTime,tb-j.startTime));judgeLine.updateDe(),chartNew.judgeLineList.push(judgeLine)}return JSON.parse(JSON.stringify(chartNew))}!function(){const tt=document.querySelector(".title");tt.addEventListener("mousedown",rttc),tt.addEventListener("touchstart",rttc);let hr=120,flag=0,flag2=0,fc=0;function rttc(){const a=setInterval(()=>{qwq[1]||(tt.style.cssText+=`;filter:hue-rotate(${3*(hr+=hr%120?1:-119)}deg)`),401*Math.random()<!qwq[1]&&(flag=1),flag&&(qwq[4]=!alert("Hyperer Mode is on..."),clearInterval(a),tt.removeEventListener("mousedown",rttc),tt.removeEventListener("touchstart",rttc),setInterval(()=>tt.style.cssText+=`;filter:hue-rotate(${3*(hr+=hr%120?1:-119)}deg)`,20),tt.removeEventListener("mouseup",rtts),tt.removeEventListener("mouseleave",rtts),tt.removeEventListener("touchend",rtts),tt.removeEventListener("touchcancel",rtts))},20);function rtts(){tt.removeEventListener("mouseup",rtts),tt.removeEventListener("mouseleave",rtts),tt.removeEventListener("touchend",rtts),tt.removeEventListener("touchcancel",rtts),clearInterval(a),tt.style.cssText+=";filter:hue-rotate(0deg);",flag||(hr=120)}tt.addEventListener("mouseup",rtts),tt.addEventListener("mouseleave",rtts),tt.addEventListener("touchend",rtts),tt.addEventListener("touchcancel",rtts)}function rttq(){if(qwqEnd.second<=0||stat.good+stat.bad)return;console.log("qwq");const a=setInterval(()=>{if(180==++fc&&(flag2=1),!qwq[5]&&flag2){qwq[5]=!alert("Reverse Mode is on..."),btnPlay.classList.add("disabled");for(const i of document.querySelectorAll("*"))!i.children.length&&(i.innerText=i.innerText.split("").reverse().join(""));for(let i=0;i<Renderer.bgMusic.numberOfChannels;i++)Renderer.bgMusic.getChannelData(i).reverse();charts[selectchart.value]=reverseChart(Renderer.chart2,Renderer.bgMusic.duration),specialClick.func[1](),clearInterval(a),canvas.removeEventListener("mousedown",rttc),canvas.removeEventListener("mouseup",rtts),canvas.removeEventListener("mouseleave",rtts),canvas.removeEventListener("touchstart",rttc),canvas.removeEventListener("touchend",rtts),canvas.removeEventListener("touchcancel",rtts)}},20);function rtts(){canvas.removeEventListener("mouseup",rtts),canvas.removeEventListener("mouseleave",rtts),canvas.removeEventListener("touchend",rtts),canvas.removeEventListener("touchcancel",rtts),clearInterval(a)}canvas.addEventListener("mouseup",rtts),canvas.addEventListener("mouseleave",rtts),canvas.addEventListener("touchend",rtts),canvas.addEventListener("touchcancel",rtts)}canvas.addEventListener("mousedown",rttq),canvas.addEventListener("touchstart",rttq)}();